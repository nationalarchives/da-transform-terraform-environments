version: 0.2

phases:
  pre_build:
    commands:
      - aws --version
      - aws configure --profile temp set credential_source EcsContainer
      - export AWS_PROFILE=temp
      - aws sts get-caller-identity

  build:
    commands:
      - cd codepipeline/lambda-deploy
      - pip install -r requirements.txt
      - |
        ./update_step_functions.sh \
          "${SF_TF_VAR_KEY_LIST}" \
          "${ENV_TF_VARS}" \
          "../../lambda_functions"

