policies:
  - name: iam-instance-profiles-not-in-use
    resource: iam-profile
    filters:
      - type: unused
  - name: iam-policy-unused
    resource: iam-policy
    filters:
      - type: unused
  - name: iam-expired-access-keys
    resource: iam-user
    filters:
      - type: access-key
        key: Status
        value: Active
      - type: access-key
        match-operator: and
        key: CreateDate
        value_type: age
        value: 90
    actions:
      - type: tag
        tags:
          custodian-lifecycle: 'expired'
  - name: user-without-mfa
    resource: iam-user
    filters:
      - type: credential
        key: mfa_active
        value: false
  - name: dormant-users
    mode:
        type: periodic
        schedule: "rate(1 day)"
        role: cloud-custodian-admin-access
    resource: iam-user
    filters:
      - type: credential
        key: password_last_used
        value_type: age
        value: 30
        op: greater-than
      - type: credential
        key: user_creation_time
        value_type: age
        value: 30
        op: greater-than
    actions:
      - type: notify
        slack_template: slack_default
        violation_desc: "Inactive users for more than 30 days"
        to:
          {slack_webhook_url}

        transport:
          type: sqs
          queue: { sqs_queu_url}

  - name: active-users
    resource: iam-user
    filters:
      - type: credential
        key: mfa_active
        value: false
      - type: credential
        key: password_enabled
        value: false
      - type: credential
        key: password_last_used
        value_type: age
        value: 30
        op: le
    actions:
      - type: notify
        slack_template: slack_default
        violation_desc: "S3 bucket missing public access block"
        action_desc: "Public access block added to S3 bucket permissions"
        to:
          {slack_webhook_url}

        transport:
          type: sqs
          queue: { sqs_queu_url}
